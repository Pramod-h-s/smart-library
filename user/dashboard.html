                                    /* ================= USER DASHBOARD ================= */
                                    userDashboard: {
                                      async init() {
                                        console.log("User Dashboard initialized");
                                    
                                        const user = Auth.getCurrentUser();
                                        if (!user) {
                                          console.warn("No authenticated user");
                                          return;
                                        }
                                    
                                        this.loadUserInfo(user);
                                        await this.loadUserStats(user);
                                        await this.loadUserTransactions(user);
                                      },
                                    
                                      /* ---------- USER INFO ---------- */
                                      loadUserInfo(user) {
                                        const nameEl = document.getElementById("userFullName");
                                        const usnEl = document.getElementById("userUSN");
                                    
                                        if (nameEl) nameEl.textContent = user.name || user.displayName || "Student";
                                        if (usnEl) usnEl.textContent = `USN: ${user.usn || "-"}`;
                                      },
                                    
                                      /* ---------- USER STATS ---------- */
                                      async loadUserStats(user) {
                                        const snap = await getDocs(
                                          query(
                                            collection(db, "transactions"),
                                            where("userId", "==", user.uid)
                                          )
                                        );
                                    
                                        const transactions = snap.docs.map(d => {
                                          const t = d.data();
                                          return {
                                            ...t,
                                            issueDate: t.issueDate?.toDate(),
                                            dueDate: t.dueDate?.toDate()
                                          };
                                        });
                                    
                                        const issued = transactions.filter(t => t.status === "issued");
                                        const overdue = issued.filter(
                                          t => t.dueDate && new Date() > t.dueDate
                                        );
                                    
                                        document.getElementById("issuedCount")?.textContent = issued.length;
                                        document.getElementById("overdueCount")?.textContent = overdue.length;
                                      },
                                    
                                      /* ---------- TRANSACTIONS TABLE ---------- */
                                      async loadUserTransactions(user) {
                                        const tbody = document.getElementById("transactionsBody");
                                        if (!tbody) return;
                                    
                                        tbody.innerHTML = "";
                                    
                                        const snap = await getDocs(
                                          query(
                                            collection(db, "transactions"),
                                            where("userId", "==", user.uid)
                                          )
                                        );
                                    
                                        if (snap.empty) {
                                          tbody.innerHTML =
                                            `<tr>
                                              <td colspan="6" class="no-data">No transactions yet.</td>
                                            </tr>`;
                                          return;
                                        }
                                    
                                        snap.docs
                                          .map(d => {
                                            const t = d.data();
                                            return {
                                              id: d.id,
                                              ...t,
                                              issueDate: t.issueDate?.toDate(),
                                              dueDate: t.dueDate?.toDate()
                                            };
                                          })
                                          .sort((a, b) => b.issueDate - a.issueDate)
                                          .forEach(t => {
                                            const isOverdue =
                                              t.status === "issued" &&
                                              t.dueDate &&
                                              new Date() > t.dueDate;
                                    
                                            const row = document.createElement("tr");
                                            row.innerHTML = `
                                              <td>${t.id}</td>
                                              <td>${t.bookTitle}</td>
                                              <td>${t.issueDate?.toLocaleDateString() || "-"}</td>
                                              <td>${t.dueDate?.toLocaleDateString() || "-"}</td>
                                              <td>
                                                <span class="status-badge status-${t.status} ${isOverdue ? "overdue" : ""}">
                                                  ${t.status.toUpperCase()}
                                                </span>
                                              </td>
                                              <td>-</td>
                                            `;
                                            tbody.appendChild(row);
                                          });
                                      }
                                    }
                                <td colspan="6" class="no-data">No transactions yet.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>

        <footer class="glass-footer">
            <div class="footer-bottom">
                <p>&copy; 2025 C. Byre Gowda Institute of Technology. All rights reserved.</p>
            </div>
        </footer>
    </div>


        <!-- âœ… ONLY MODULE SCRIPTS -->
        <script type="module">
          import { protectPage } from "../js/auth-check.js";
          import "../js/ui.js";
          import "../js/pages.js";
        
          // ðŸ” Protect student dashboard
          protectPage("student");
        
          // Page init
          document.addEventListener("DOMContentLoaded", () => {
            UI.renderNav();
            Pages.userDashboard.init();
          });
        </script>
</body>

</html>

